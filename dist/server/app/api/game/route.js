"use strict";(()=>{var e={};e.id=7009,e.ids=[7009],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},94181:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>y,requestAsyncStorage:()=>l,routeModule:()=>q,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>_});var s={};r.r(s),r.d(s,{GET:()=>GET,POST:()=>POST}),r(95655);var a=r(83323),o=r(54647),n=r(11805),i=r(10478),u=r(45952);let p=u.z.object({topic:u.z.string().min(4,{message:"Topic must be at least 4 characters long"}).max(50),type:u.z.enum(["mcq","open_ended"]),amount:u.z.number().min(1).max(10)});var c=r(66886),d=r(41779);async function POST(e,t){try{let t=await (0,i.P)();if(!t?.user)return c.Z.json({error:"You must be logged in to create a game."},{status:401});let r=await e.json(),{topic:s,type:a,amount:o}=p.parse(r),u=await n._.game.create({data:{gameType:a,timeStarted:new Date,userId:t.user.id,topic:s}});await n._.topic_count.upsert({where:{topic:s},create:{topic:s,count:1},update:{count:{increment:1}}});let{data:m}=await d.Z.post(`${process.env.API_URL}/api/questions`,{amount:o,topic:s,type:a});if("mcq"===a){let e=m.questions.map(e=>{let t=[e.option1,e.option2,e.option3,e.answer].sort(()=>Math.random()-.5);return{question:e.question,answer:e.answer,options:JSON.stringify(t),gameId:u.id,questionType:"mcq"}});await n._.question.createMany({data:e})}else"open_ended"===a&&await n._.question.createMany({data:m.questions.map(e=>({question:e.question,answer:e.answer,gameId:u.id,questionType:"open_ended"}))});return c.Z.json({gameId:u.id},{status:200})}catch(e){if(e instanceof u.z.ZodError)return c.Z.json({error:e.issues},{status:400});return c.Z.json({error:"An unexpected error occurred."},{status:500})}}async function GET(e,t){try{let t=await (0,i.P)();if(!t?.user)return c.Z.json({error:"You must be logged in to create a game."},{status:401});let r=new URL(e.url),s=r.searchParams.get("gameId");if(!s)return c.Z.json({error:"You must provide a game id."},{status:400});let a=await n._.game.findUnique({where:{id:s},include:{questions:!0}});if(!a)return c.Z.json({error:"Game not found."},{status:404});return c.Z.json({game:a},{status:400})}catch(e){return c.Z.json({error:"An unexpected error occurred."},{status:500})}}let m=a.AppRouteRouteModule,q=new m({definition:{kind:o.x.APP_ROUTE,page:"/api/game/route",pathname:"/api/game",filename:"route",bundlePath:"app/api/game/route"},resolvedPagePath:"/Users/zeds/Documents/Coding/ANDELA/Projects/quizmify/src/app/api/game/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:x,serverHooks:g,headerHooks:w,staticGenerationBailout:_}=q,y="/api/game/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[7395,4959,9506,9727,4467,804,1779,478],()=>__webpack_exec__(94181));module.exports=r})();